## DDBOT最近更新日志

- 2023-09-25 v1.1.4
  - 更新登录代码
```
# 本版本需要配置签名服务器，详情请看https://github.com/Mrs4s/go-cqhttp/issues/2242
# 请在application.yaml文件中添加配置:
sign:
  # 数据包的签名服务器列表，第一个作为主签名服务器，后续作为备用
  # 兼容 https://github.com/fuqiuluo/unidbg-fetch-qsign
  # 如果遇到 登录 45 错误, 或者发送信息风控的话需要填入一个或多个服务器
  # 不建议设置过多，设置主备各一个即可，超过 5 个只会取前五个
  # 示例:
  # sign-servers:
  #   - url: 'http://127.0.0.1:8080' # 本地签名服务器
  #     key: "114514"  # 相应 key
  #     authorization: "-"   # authorization 内容, 依服务端设置
  #   - url: 'https://signserver.example.com' # 线上签名服务器
  #     key: "114514"
  #     authorization: "-"
  #   ...
  #
  # 服务器可使用docker在本地搭建或者使用他人开放的服务
  servers:
    - url: ''  # 主签名服务器地址， 必填
      key: '114514'  # 签名服务器所需要的apikey, 如果签名服务器的版本在1.1.0及以下则此项无效
      authorization: ''   # authorization 内容, 依服务端设置，如 'Bearer xxxx'
    - url: ''  # 备用
      key: '114514'
      authorization: ''

  # 判断签名服务不可用（需要切换）的额外规则
  # 0: 不设置 （此时仅在请求无法返回结果时判定为不可用）
  # 1: 在获取到的 sign 为空 （若选此建议关闭 auto-register，一般为实例未注册但是请求签名的情况）
  # 2: 在获取到的 sign 或 token 为空（若选此建议关闭 auto-refresh-token ）
  rule-change-sign-server: 1

  # 连续寻找可用签名服务器最大尝试次数
  # 为 0 时会在连续 3 次没有找到可用签名服务器后保持使用主签名服务器，不再尝试进行切换备用
  # 否则会在达到指定次数后 **退出** 主程序
  max-check-count: 0
  # 签名服务请求超时时间(s)
  server-timeout: 60
  # 如果签名服务器的版本在1.1.0及以下, 请将下面的参数改成true
  # 建议使用 1.1.6 以上版本，低版本普遍半个月冻结一次
  is-below-110: false
  # 在实例可能丢失（获取到的签名为空）时是否尝试重新注册
  # 为 true 时，在签名服务不可用时可能每次发消息都会尝试重新注册并签名。
  # 为 false 时，将不会自动注册实例，在签名服务器重启或实例被销毁后需要重启 go-cqhttp 以获取实例
  # 否则后续消息将不会正常签名。关闭此项后可以考虑开启签名服务器端 auto_register 避免需要重启
  # 由于实现问题，当前建议关闭此项，推荐开启签名服务器的自动注册实例
  auto-register: false
  # 是否在 token 过期后立即自动刷新签名 token（在需要签名时才会检测到，主要防止 token 意外丢失）
  # 独立于定时刷新
  auto-refresh-token: false
  # 定时刷新 token 间隔时间，单位为分钟, 建议 30~40 分钟, 不可超过 60 分钟
  # 目前丢失token也不会有太大影响，可设置为 0 以关闭，推荐开启
  refresh-interval: 40
```
- 2023-08-25 v1.1.3
  - 更新登录代码 
```
# 本版本需要配置签名服务器，详情请看https://github.com/Mrs4s/go-cqhttp/issues/2242
# 请在application.yaml文件中添加配置:
sign:
  # 数据包的签名服务器
  # 兼容 https://github.com/fuqiuluo/unidbg-fetch-qsign
  # 如果遇到 登录 45 错误, 或者发送信息风控的话需要填入一个服务器
  # 示例:
  # server: 'http://127.0.0.1:8080' # 本地签名服务器
  # server: 'https://signserver.example.com' # 线上签名服务器
  # 服务器可使用docker在本地搭建或者使用他人开放的服务
  server: ''
  # 签名服务器认证 Bearer Token
  # 使用开放的服务可能需要提供此 Token 进行认证
  server-bearer: ''
  # 如果签名服务器的版本在1.1.0及以下, 请将下面的参数改成true
  is-below-110: false
  # 签名服务器所需要的apikey, 如果签名服务器的版本在1.1.0及以下则此项无效
  # 本地部署的默认为114514
  key: '114514'
  # 在实例可能丢失（获取到的签名为空）时是否尝试重新注册
  # 为 true 时，在签名服务不可用时可能每次发消息都会尝试重新注册并签名。
  # 为 false 时，将不会自动注册实例，在签名服务器重启或实例被销毁后需要重启 go-cqhttp 以获取实例
  # 否则后续消息将不会正常签名。关闭此项后可以考虑开启签名服务器端 auto_register 避免需要重启
  auto-register: false
  # 是否在 token 过期后立即自动刷新签名 token（在需要签名时才会检测到，主要防止 token 意外丢失）
  # 独立于定时刷新
  auto-refresh-token: false
  # 定时刷新 token 间隔时间，单位为分钟, 建议 30~40 分钟, 不可超过 60 分钟
  # 目前丢失token也不会有太大影响，可设置为 0 以关闭，推荐开启
  refresh-interval: 40
```
- 2023-07-01 v1.1.2
  - 更新登录代码 
```
# 本版本需要配置签名服务器，详情请看https://github.com/Mrs4s/go-cqhttp/issues/2242
# 请在application.yaml文件中添加配置:
sign-server: "你的签名服务器"
```
- 2023-05-27 v1.1.1
  - 更新登录代码
  - 更新b站接口签名
- 2023-03-21 v1.1.0
  - 适配新miraigo和登录代码（更新时需要手动删除device.json文件）
- 2022-10-19 v1.0.9.2
  - 修复grant命令
- 2022-10-02 v1.0.9
  - 通用：
    - 更新b站DynamicHistory接口
    - 修复b站XSpaceAccInfo接口-401错误
    - 升级go版本至1.19
    - 现在推送时@全员合并成一条消息
  - 模板：
    - 现在会自动去除模板文件的bom，带有bom的模板不会再意外地换行了
    - 新增支持发送戳一戳消息，和戳一戳事件模板
    - 新增模板函数`bot_uin`返回bot的qq号码
    - 新增模板变量`{{ .template_name }}`返回当前执行的模板名字
    - 新增模板函数`cooldown`可以设置计时
    - 新增模板函数`openFile`用于读取本地文件
    - 新增模板函数`abort`用于退出当前模板，并且已经产生的消息将被丢弃，如果有传入参数，参数将被作为消息发送
    - 新增模板函数`fin`用于退出当前模板，并且已经产生的消息将被发送，未处理的模板代码将被跳过
- 2022-07-05 v1.0.8
  - 通用：
    - 从零开始的BOT不会再提醒迁移数据库了
    - 增加了数据库独占锁，当尝试重复启动单个BOT时将提示错误以防止数据库损坏 *（不会影响多个BOT同时使用）*
    - windows下一些致命错误将使用messagebox提示
    - 修复一些条件下无法正常触发命令的情况
    - 增加`/检测异常订阅`命令用于查询未能正常退出的群的订阅
    - 增加`/清除订阅`命令用于清除异常订阅，或者清除指定群的订阅，清除时可以指定订阅网站和种类
  - 模板：
    - 修复32位下模板无法解析int64的情况
    - 自定义命令支持@成员参数
    - 新增模板命令获取指定成员的基本信息
    - 模板函数`choose`现在可以在每一项后增加一个可选的权重（整数），如未指定则为1
    - 自定义命令新增{{.full_args}}获取完整的包含空格的字符串格式的参数
    - 自定义命令现在遇到非文字内容（图片等）时会跳过该内容，而不是直接停止解析参数
    - 模板现在允许比较字符串类型的数字和数字类型的数字
    - 修复私聊模板无法获取参数的问题
    - 新增模板函数`{{weekday}}`获取当天是星期几
    - 新增一系列模板函数，包括字符串、list、dict、数学、哈希、默认值空值
    - 模板函数`pic`支持base64字符串格式的图片
    - 新增模板函数`httpGet` `httpPostJson` `httpPostForm`用于发送http get/post请求
    - 新增模板函数`toGJson`用于处理json
    - 修复customCommandPrefix不支持大写字母的问题
- 2022-05-17 v1.0.7
  - 通用：
    - 修复@时显示QQ号的问题（这次是真的）
    - 修复release ci没有正确设置版本的问题
    - 支持重定义特定命令的前缀，可以设置无需前缀的自定义命令，参考完整配置的`customCommandPrefix`
    - 支持定义`cronjob`定时消息模板，详细介绍请看[模板介绍](/TEMPLATE.md)
    - 增加b站下播的准确检查，现在不会再发生`错误下播->马上开播`的情况了
  - 模板：
    - 现在支持自定义命令传入文字参数，在模板中可以通过{{.cmd}}和{{.args}}变量获取命令名字和参数
    - 增加`trigger.private.new_friend_added.tmpl`事件模板
    - 增加`trigger.private.group_invited.tmpl`事件模板
    - 增加`hour minute second month year day yearday`等时间函数
    - 新增私聊命令`/ping`支持模板
    - 模板函数`pic`默认不再对url图片进行缓存，这意味着会返回随机图片的url可以正常工作了
- 2022-04-14 v1.0.6
  - 通用：
    - 更换自定义miraigo，可能减少消息发送失败
    - 增加定时监测新版本，并会通知Admin
    - 使用新的推送限流方式，现在更多地考虑账号稳定
    - 支持Concern启动失败，没有启动成功的Concern无法再使用相关命令
    - 支持B站不配置帐号使用，仅推荐订阅**不超过5个**时使用（用于初次部署时快速验证），**配置帐号仍旧是最佳方案**
    - 修复@时显示QQ号的问题
    - 增加推送消息的并发配置，默认为1以优先保证账号稳定，当出现推送堆积的时候可以尝试调高
    - 支持配置不推送BOT离线期间的B站动态和直播
    - 现在当BOT设置为私人模式时，被私自拉进群聊时无法再使用了（当群聊人数较少时，系统会直接同意，无法拒绝）
  - 模板：
    - 模板函数pic支持本地gif
    - 新增模板函数用于@成员
    - 新增模板函数显示成员头像
    - 增加更多消息模板上下文，主要是群命令和私聊命令的member_code/member_name
    - 现在模板消息会自动去掉模板末尾的EOL，一些editor可能会自动添加EOL（eg. VIM）
- 2022-04-04 v1.0.5
  - 增加巨量推送的判定配置，默认为50
  - 修复无法使用socks5协议代理的问题
  - 增加b站禁止自动关注的配置，这意味着只能订阅b站帐号内已经关注的用户；当需要订阅新用户时，只能手动在b站关注
  - qq聊天记录默认不再输出到终端，需要手动配置开启，过去为默认开启
  - 修复油管推送当多个群订阅的时候，只能发送到一个群的问题 (fix #129)
  - 修复一个和推送@相关的race condition
  - 修复推送时可能多次@全员的问题
  - 增加消息模板，为一些功能的实现做准备，模板的详细介绍请看[模板介绍](/TEMPLATE.md)
  - 增加自定义命令回复，触发命令时自动回复定义的模板消息，模板的详细介绍请看[模板介绍](/TEMPLATE.md)
  - **模板尚处于实验性质，不排除模板规则变动的可能**
- 2022-02-14 v1.0.4
  - 现在`/admin`命令在有权限的情况下支持列出一个群内的GroupAdmin
  - 修复登陆出现的问题
  - 增加巨量推送时的限流，当一次性推送至50个群以上时，将增加推送延迟避免被封qq号
  - 现在支持手动关注b站用户，当ddbot订阅b站用户关出现注失败时，可以手动登陆b站账号关注，这个功能可能有几十秒的延迟
  - 支持设置b站关注需要的粉丝数量，当粉丝数量不足时无法订阅，这主要是用来过滤一些无用的测试订阅（仍然可以手动登陆b站关注）
  - 更新微博图片到原图
- 2022-01-27 v1.0.3
  - 支持配置不在命令行内显示qq聊天记录
  - 现在admin邀请bot加群时会自动同意，不论bot设置成什么mode
  - 更好的自适应命令名称
  - 在windows平台增加了额外退出机制保证在点击console ×的时候可以正常退出
  - 修复acfun无法订阅的问题
  - 修复b站订阅的账号异常问题
  - 更好的`twitcasting`订阅 ( by [@eric2788](https://github.com/eric2788) )
- 2021-12-24 v1.0.2
  - 新增订阅源`twitcasting` ( by [@eric2788](https://github.com/eric2788) )
  - 支持socks5代理
  - 增加miraigo `AnimatedSticker` 支持
  - 更新miraigo解决SSO frame panic问题
  - *merry Christmas*
- 2021-12-08 v1.0.1.1
  - 由于发现登陆出现问题，快速更新miraigo版本发现似乎可以解决
  - 修复douyu/huya一些情况下在订阅的时刻会立即错误推送的问题
- 2021-12-05 v1.0.1
  - 修复更新检查会失败的问题
  - 优化推送时内存的使用，现在对内存的使用大幅优化了
  - 更新miraigo消息类型
  - 更新项目整体结构，优化依赖，现在可以通过`DDBOT.Run`方法启动bot，编写插件时更加方便了
  - b站直播推送链接去掉了多余的参数
  - 修复油管一些情况不推送的问题
  - 修复在某些情况下unwatch一些不存在的订阅的时候会返回成功的问题
  - 增强一些错误信息
- 2021-11-19 v1.0.0
  - 升级到DDBOTv2版本，v1版本将不会再增加订阅源，v2版本预计将会支持更多订阅源
  - 实现数据库迁移机制，支持无缝从v1迁移到v2
  - 更新b站推送@机制，如果bot因为一些原因一段时间没有成功刷新b站，则启动之后前几次刷新时不会触发@指令（即延迟的消息不再@）。
  - b站推送缩略推送增加了动态时间
  - 更新b站缩略推送样式，现在如果可以会回复之前推送的动态
  - 增加b站 cookie过期检测，现在可以正确处理cookie提前过期了（b站自动登录目前为失效状态）
  - 支持b站账号订阅账号自身的动态和直播
  - b站动态推送增加更多检测被审核动态的方法（目前仍无法100%找回）
  - 增加了一些缓存，优化在低带宽（<=1m）环境下的表现
  - 删除`/face`命令，去除gocv，不再支持使用gocv
  - `/list`命令支持网站参数，可以通过`-s`指定要查询的网站，防止订阅网站过多
  - 增加命令前缀的配置，默认为斜杠`/`，可自定义成其他
  - 删除芝麻代理配置，不再支持芝麻代理池
  - 限制bot发言频率，避免同一时间推送过过过于频繁而被封号（私人bot的发言频率几乎不会受到影响）
  - 修复当消息带有回复时，@检查失效的问题
  - **新增支持ACFUN直播推送，微博动态推送**
  - **升级到v1.0.0之后无法再退回v1.0.0版本以下！如果您追求稳定性，可以选择暂时不升级**
- 2021-10-14 v0.1.4
  - 增加@检查，当消息以@开头，如果@对象不是当前bot，则会跳过本条消息
  - local proxy pool 会自动识别uri schema了，如果没有schema，则默认是http，因此也支持https了。
  - 增加b站登陆失败原因信息
  - 修复一些bug
  - 删除阿里云相关功能
  - 一些悄悄地升级到v2版本的准备工作
- 2021-10-10 v0.1.3.1
  - 修复开启取关配置后，在特定情况下，b站会错误取消关注的情况
  - 完善取关触发时机，触发退群时也会尝试取关了
- 2021-10-08 v0.1.3
  - 增加多次转发的省略机制，短时间推送同一条动态的多次转发时，只有第一次会显示全部内容，后续转发动态将被省略（看asoul更方便了）
  - 更新b站FeedList接口逻辑，减少在b站接口失败时会误报的情况
  - 增加b站4302类型动态
  - 增加管理员命令`/admin`，用于查看当前拥有Admin权限的人
  - 增加进群后修改bot改名的配置，现在可以自定义改名内容或者取消改名了
  - 支持配置b站关注时使用悄悄关注
  - 支持设置b站自动取消关注
  - 支持设置沉默模式，会减少一些命令的输出信息，具体范围请看命令文档
- 2021-09-20 v0.1.2
  - 修复youtube推送有时候被错误过滤掉的问题
  - 修复审核模式下同意单个好友请求时，会删除剩下的请求的问题
  - 更新b站直播刷新链接（与PC web端保持一致）
  - 增加掉线时处理方式配置，可以禁用自动重连
  - 更新ci及ut配置
- 2021-08-31 v0.1.1
  - 增加启动完成时的文案，避免让人以为卡住了
  - 支持当b站使用帐号密码登陆时，cookie可以自动过期并且刷新了
  - 支持配置b站图片是否合并
  - 修复b站转发动态原动态失效时会推送错误格式的问题
  - 修复关注b站动态时有时候会错误地显示一条关于直播的提示的问题
- 2021-08-23 v0.1.0.1
  - 更新b站登陆方案，修复b站登陆失效的问题
- 2021-08-22 v0.1.0
  - 支持设置bot运行模式，支持“公开”、“私人”、“审核”三种，私人模式下bot会拒绝群邀请和好友申请，审核模式下bot会保留申请，等待审核
  - 优化了一些性能，减少了写磁盘频率
  - 不再推送b站4308类型的动态（对应发布直播信息的推送，应该不是手动发布的），新增b站4098/4099/4101/4300类型的动态
  - 修复取消最后一个直播订阅时，无法刷新直播状态的问题
  - 修复local image pool不支持图片数量的问题
  - 修复退群时有一些key没被删除的问题
  - 修复config命令有时候没有答复的问题
- 2021-08-14 发布 v0.0.20
  - 支持关闭消息自动已读功能
  - 支持配置图床代理，默认使用`pixiv.cat`
  - 升级至miraigo最新版本
  - 修复本地时间有误差时可能无法操作bot的问题
  - 重构了日志格式，更换成更适合人类阅读的格式
  - 更新了b站图片merge的策略
  - 增加联合投稿的防刷屏机制，短时间内多人联合投稿，后续动态将被简化
  - 下播推送时去掉了链接
- 2021-08-09 发布 v0.0.19
  - 支持了优雅停机，现在关闭DDBOT时会等待排队的推送发送完毕。
  - 更新了合并图片的逻辑，现在在非9图但比较刷屏的情况也会合并图片了。
  - 增加了合并图片的缓存，之前同一动态在多个群内推送时会每个群都做一次合并图片。
  - 增加了版本管理，以及启动时检查更新的逻辑。
  - 更新了许多日志文案信息。
  - 修复了私聊消息已读没有生效的bug。
  - 去除了全体禁用的检测（因为管理员权限并不准确）。
  - 支持了b站直播预约抽奖。
  - 增强了quit命令清除数据的力度。
  - 简化了帮助信息，只留下最常见的使用场景，其他详细命令请看命令文档。
  - 增加了b站订阅直播时检测粉丝数的逻辑，如果粉丝数过少，将提示确认订阅无误（主要是用直播间ID来订阅的情况，直播间ID也可能是合法的UID）。
- 2021-08-01 发布 v0.0.18
  - 增加了管理员命令/quit，用于退出群聊，或清除未正常退出的群的数据。
  - 重构buntdb支持嵌套事务，现在被禁言时不会再尝试推送了
- 2021-07-24 发布 v0.0.17
  - 增加了b站使用账号密码登陆，可以不用再手动填cookie了（非常容易出错）
- 2021-07-17 发布 v0.0.16
  - 增加了禁用单个命令的管理员命令，对所有群组生效
- 2021-07-12 发布 v0.0.15
  - 改善了初次使用的体验（增加扫码登陆，自动生成device.json和application.yaml）

- 增加了config配置下播推送，直播间标题推送，开启@全体成员，b站动态推送过滤器。
- 增加了config命令，目前支持配置推送同时@成员（实验阶段，并不保证稳定，目前只支持直播推送）。
- 增加了私聊的grant命令，现在可以通过私聊配置qq群内的群友命令权限了。
- 更新了list命令，现在list命令会展示所有网站的所有订阅，不必再指定-s和-t了。
- 增加了私聊的list命令，现在可以通过私聊查看订阅列表了。
- 增加了虎牙直播的推送。
- 增加了私聊的enable和disable命令，现在可以通过私聊配置qq群内的命令了。
- 增加了私聊的watch和unwatch命令，现在可以通过私聊配置qq群内的订阅了（注意仍然是qq群推送）。
- 更换船新b站监控方案，预计单帐号可支持1000订阅，最大延迟30秒。
